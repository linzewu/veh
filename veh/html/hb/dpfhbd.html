<div id="dpfhbdLay" class="easyui-layout" style="width:960px;height:560px;">
		<div style="font-size: 20px; color: red;">力负荷标定</div>
		<div align="center" style="height: 200px; font-size: 18px; width:100%;">
			<table>
				<tr>
					<td>力测量值：</td>
					<td><input class="easyui-textbox" style="width:60px;" id="hb_vide_dpfhbd_lclz" value="0"></td>
					
					<td><a href="#" class="easyui-linkbutton" onclick="dpfhbd_zero" data-options="width:90"><span style="font-size: 15px">零点</span></a>
					4块砝码的标准值（N）：</td>					
					
				</tr>
				<tr>
					<td></td>
					<td style="width: 30%"></td>
					<td>
						<a href="#" class="easyui-linkbutton" onclick="" data-options="width:90"><span style="font-size: 15px">满度</span></a>
						<input class="easyui-textbox" style="width:60px;" id="hb_dpfhbd_md" value="400">
					</td>
				</tr>
				
			</table>			
			<br/>
			<div id="p" class="easyui-panel" title="说明" style="width:100%;height:150px;font-size: 14px">
		        <ul>
		            <li>1.挂好力臂，挂上拉钩，等力电压值稳定后，点击“零点”。</li>
		            <li>2.挂上对应的砝码，等力电压值稳定后，点击“满度”。</li>
		            <li>3.各个校验点相对误差小于等于1%合格。</li>
		        </ul>
		    </div>
		</div>        
		<table class="easyui-datagrid" style="height:260px" id="hb_dpfhbd_table_check"
        data-options="fitColumns:true,singleSelect:true,rownumbers:true,data:initDate()">
		    <thead>
		        <tr>
		            <th data-options="field:'lllz',width:100">理论力（N）</th>
		            <th data-options="field:'sjlz',width:100">实测力（N）</th>
		            <th data-options="field:'xdwc',width:100">绝对误差（N）</th>
		            <th data-options="field:'jdwc',width:100">相对误差（%）</th>
		        </tr>
		    </thead>
		</table>
		<div align="center" style="width:100%;">
			<a href="#" class="easyui-linkbutton" onclick="dpfhbd_check()" data-options="width:90,size:'large'"><span style="font-size: 15px">校验</span></a>&nbsp;&nbsp;
			<a href="#" class="easyui-linkbutton" onclick="close_hb_win()" data-options="width:90,size:'large'"><span style="font-size: 15px">退出</span></a>&nbsp;&nbsp;
		</div>
    </div>
    <script type="text/javascript">
    
	    
	    
	    function getAbs(){
	    	var md = $("#hb_dpfhbd_md").textbox("getValue");
	    	return md/4;
	    }
	    
	    function dpfhbd_check(){
	    	var rows = $("#hb_dpfhbd_table_check").datagrid("getRows");
	    	$.each(rows,function(i,n){
	    		if(n.lllz==null){
	    			if(i==0){
	    				n.lllz=0;
	    				n.sjlz=0;
	    				n.xdwc=0;
	    				n.jdwc=0;
	    				$("#hb_dpfhbd_table_check").datagrid("refreshRow",i);
	    				return false;
	    			}else if(i<=4){
	    				var prv=rows[i-1];
	    				var abs = getAbs();
	    				n.lllz=prv.lllz+abs;
	    				n.sjlz=$("#hb_vide_dpfhbd_lclz").textbox("getValue");
	    				n.xdwc = n.sjlz-n.lllz;
	    				n.jdwc =  (Math.abs(n.xdwc)/abs)*100;
	    				$("#hb_dpfhbd_table_check").datagrid("refreshRow",i);
	    				return false;
	    			}else if(i>4&&i<=8){
	    				var prv=rows[i-1];
	    				var abs = getAbs();
	    				n.lllz=prv.lllz-abs;
	    				n.sjlz=$("#hb_vide_dpfhbd_lclz").textbox("getValue");
	    				n.xdwc = n.sjlz-n.lllz;
	    				n.jdwc =  (Math.abs(n.xdwc)/abs)*100;
	    				$("#hb_dpfhbd_table_check").datagrid("refreshRow",i);
	    				
	    				if(i==8){
	    					$.messager.alert("提示！","负荷标定完成"+(getDpfhbdjg()==true?"通过":"不通过"));
	    				}
	    				
	    				return false;
	    			}
	    		}else{
	    			if(i==8){
	    				$.messager.alert("提示！","负荷标定完成"+(getDpfhbdjg()==true?"通过":"不通过"));
	    			}
	    		}
	    	});
	    	
	    }
	    
	    function getDpfhbdjg(){
	    	var rows = $("#hb_dpfhbd_table_check").datagrid("getRows");
	    	
	    	var jg=true;
	    	
	    	$.each(rows,function(i,n){
	    		if(n.jdwc>1){
	    			jg=false;
	    			return false;
	    		}
	    	});
	    	return jg;
	    }
    
    	function initDate(){
    		var data=[];
    		for(var i=0;i<9;i++){
    			data[i]={lllz:null,sjlz:null,xdwc:null,jdwc:null};
    		}
    		return data;
    	}
    	
    	var xcId = setInterval(function(){
    		sendMessage(cgjsock,"dqsj");
    	},500);
    	
    	threadArray.push(xcId);
    	
    	if(cgjsock){
    		cgjsock.onmessage=function(e){
        		console.log(e.data);
        		var json = $.parseJSON(e.data);
        		if(json.nl!=0){
        			json.nl=json.nl-dpfhbd_temp_weight;
        			$("#hb_vide_dpfhbd_lclz").textbox("setValue",json.nl);
        		}
        		
        	}
    	}
    	var dpfhbd_temp_weight=0;
    	function dpfhbd_zero(){
    		dpfhbd_temp_weight=$("#hb_vide_dpfhbd_lclz").textbox("getValue");
    	}
    	
    
    </script>