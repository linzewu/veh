<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>上海翔尚机动车环保尾气检测系统</title>
<link rel="stylesheet" type="text/css"
	href="/veh/js/easyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css" href="/veh/js/easyui/themes/icon.css">
<link rel="stylesheet" type="text/css"
	href="/veh/js/easyui/themes/color.css">
<link rel="stylesheet" type="text/css" href="/veh/css/veh.css">
<link rel="stylesheet" type="text/css"
	href="/veh/js/easyui/themes/icon.css">
<script type="text/javascript" src="/veh/js/easyui/jquery.min.js"></script>
<script type="text/javascript" src="/veh/js/easyui/jquery.easyui.min.js"></script>
<script type="text/javascript"
	src="/veh/js/easyui/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript"
	src="/veh/js/easyui/datagrid-groupview.js"></script>
<script type="text/javascript" src="/veh/js/common.js"></script>
<script type="text/javascript" src="/veh/js/highcharts/highcharts.js"></script>
<script type="text/javascript" src="/veh/codebase/webVideoCtrl.js"></script>
</head>
<body  class="easyui-layout">
	<div data-options="region:'north'" class="header" style="height: 52px">
		<div style="float: left; margin: 0 0 0 30px;">
			<img alt="" src="/veh/images/logo.png" style="border: 0; margin: 0">
		</div>
		<div class="header-title" style="float: left;">上海翔尚机动车环保尾气检测系统</div>
	</div>
	
	<div data-options="region:'center'">
		 <div class="easyui-panel" style="padding:5px;">
		 	<a href="#" class="easyui-menubutton" data-options="menu:'#wj'">文件</a>
		 	<a href="#" class="easyui-menubutton" onclick="open_Page('系统自检','xtzj.html','550px')">系统自检</a>
		 	<a href="#" class="easyui-menubutton" onclick="open_Page('设备日常检验','rcjc.html','550px')">日常检查</a>
	        <a href="#" class="easyui-menubutton" data-options="menu:'#dpcgq'">底盘测功器</a>
	        <a href="#" class="easyui-menubutton" data-options="menu:'#qywqfxy'">汽油尾气分析仪</a>
	      	<a href="#" class="easyui-menubutton" data-options="menu:'#cywqfxy'">柴油尾气分析仪</a>
	      	<a href="#" class="easyui-menubutton" data-options="menu:'#cysbjc'">柴油设备检查</a>
	      	<a href="#" class="easyui-menubutton" data-options="menu:'#rcgzjl'">日常故障记录</a>
	      	<a href="#" class="easyui-menubutton" data-options="menu:'#rysbxxb'">人员设备信息表</a>
	      	<a href="#" class="easyui-menubutton" data-options="menu:'#obdjc'">OBD检测</a>
	      	<a href="#" class="easyui-menubutton" data-options="menu:'#qcpfcs'">汽车排放测试</a>
	    </div>
	    <div id="wj" style="width:200px;">
	        <div onclick="open_Page('通信口设置','txksz.html','550px')">通信口设置</div>
	    </div>
	    
	    <div id="hb_view_index_context">
	    	<div id="hb_view_index_device">
	    		
	    	</div>
	    </div>
	    
	    <div id="dpcgq" style="width:200px;">
	    	<div onclick="open_Page('寄生功率测试LGD','jsglcslgd.html','550px')">寄生功率测试LGD</div>
	    	<div onclick="open_Page('底盘负荷准确度测试LGD','dpfhzqdcslgd.html','550px')">底盘负荷准确度测试LGD</div>
	        <div onclick="open_Page('*底盘预热','dpyr.html','550px')">*底盘预热</div>
	        <div onclick="open_Page('*寄生功率测试','kzhx.html','600px')">*寄生功率测试</div>
	        <div onclick="open_Page('*底盘加载滑行测试','jzhx.html','600px')">*底盘加载滑行测试</div>
	        <div onclick="open_Page('底盘负荷标定','dpfhbd.html','600px')">底盘负荷标定</div>
	        
	        <div onclick="open_Page('底盘变负荷滑行-时间','dpbfhhxsj.html','600px')">底盘变负荷滑行-时间</div>
	        <div >底盘变负荷滑行-车速</div>
	        <div onclick="open_Page('底盘负荷准确度测试','dpfhzqdcs.html','600px')">底盘负荷准确度测试</div>
	        
	        <div onclick="open_Page('底盘加载响应时间(共)','dpjzxyshg.html','600px')">底盘加载响应时间(共)</div>
	        <div>底盘加载精度测试</div>
	        <div onclick="open_Page('转速自检','dpxsdjc.html','600px')">底盘线速度检查</div>
	        <div onclick="open_Page('基本惯量确定','dpjbglcs.html','600px')">底盘基本惯量测试</div>
	        <div onclick="open_Page('基本惯量--计量','dpjbglcsjl.html','600px')">底盘基本惯量测试计量</div>
	        <div onclick="open_Page('控制器检查','kzqjc.html','450px')">控制器检查</div>
	        <div onclick="open_Page('功率吸收能力检查','glxsdycs.html','560px')">功率吸收能力检查</div>
	        
	    </div>
	    <div id="qywqfxy" style="width:150px;">
	        <div onclick="open_Page('高气标定','gqbd.html','450px')">高气标定</div>
	        <div onclick="open_Page('*低气检查和响应时间','dqjchxysj.html','600px')">*低气检查和响应时间</div>
	        <div>五点气体检查</div>
	        <div >*泄露检查</div>
	        <div >*氧传感器自检</div>
	        <div >*低流量自检</div>
	    </div>
	    <div id="cywqfxy" style="width:150px;">
	        <div >高气标定</div>
	        <div >高气标定NO2</div>
	        <div >低气检查</div>
	        <div >低气检查NO2</div>
	        <div >泄露检查</div>
	        <div >低流量自检</div>
	    </div>
	    <div id="cysbjc" style="width:150px;">
	        <div >不透光烟度计检查</div>
	        <div >滤纸式烟度计检查</div>
	    </div>
	    
	    <div id="rcgzjl" style="width:200px;">
	    </div>
	    <div id="rysbxxb" style="width:200px;">
	    </div>
	    <div id="obdjc" style="width:200px;">
	    </div>
	    <div id="qcpfcs" style="width:200px;">
	    </div>
	</div>
	
	<div id="dpyr_win" class="easyui-window" title="底盘预热" style="width:1000px;height:450px"
        data-options="iconCls:'icon-save',modal:true,closed:true,resizable:false,maximizable:true,collapsible:false,minimizable:false">
</div>
</body>

<script type="text/javascript">
function open_Page(title,page,height){
	var url ="/veh/html/hb/"+page+"?"+new Date().getTime();
	$("#dpyr_win").window({"title":title,"height":height});
	$("#dpyr_win").window('open');
	$("#dpyr_win").window('refresh', url);
}

var sockMap={};

$(function(){
	$.post("/veh/hb/getHBDeviceConfigByIp",function(data){
		$.each(data,function(i,n){
			 var deviceHtml=$("<div id=\"hb_view_index_device_"+n.id+"\"></div>");
		     deviceHtml.attr("class","easyui-draggable");
		     deviceHtml.attr("data-options","handle:'#device_id_"+n.id+"'");
		     deviceHtml.css({"width":"200px","border":"1px solid #ccc"});
		     deviceHtml.append("<div id=\"#device_id_"+n.id+"\" style=\"background:#ddd;padding:5px;\">"+n.name+"</div>");
		     deviceHtml.append("<div style=\"padding:20px\"  ><p>串口："+n.com+"</p><p id=\"hb_index_view_device_state_"+n.id+"\">状态："+n.com+"</p></div>");
			$("#hb_view_index_device").append(deviceHtml);
			
			$.post("/veh/device/getState",{id:n.id},function(state){
				$("#hb_index_view_device_state_"+n.id).text("状态："+(state.isOpen==true?'开':'关'));
				if(state.isOpen){
					var url = 'ws://' + window.location.host + '/veh/websocket/deviceId_'+n.id;
					var sock = new WebSocket(url); //打开WebSocket
					$(window).unload(function() {
						sock.close();
					});
					sockMap["deviceId_"+n.id]=sock;
				}
				
				
			});
		});
	});
	
});


</script>
</html>