<script type="text/javascript" src="/veh/js/data.js"></script>
<table id="grid_process">
   
</table>
<div id="win_play" class="easyui-window" data-options="
												    width:850,
												    height:630,
												    modal:true,
												    title:'视频播放',
												    closed:false,
												    closable:true,
												    minimizable:false,
												    collapsible:false,
												    maximizable:false,
												    draggable:false,
												    closed:true">

	<div id="cc" class="easyui-layout" fit='true'>

		<div data-options="region:'north'" style="height: 50px;">
			<div class="vehinfo">
				<label>号牌号码：</label>
				<input value="" disabled="disabled" id="info_hphm" />
				<label>检验流水号：</label>
				<input id="info_jylsh" disabled="disabled" />
				<label>检测站名称：</label>
				<input value="" disabled="disabled" id="jyjgbh" />
				
				<label>时间推移：</label><input class="easyui-numberbox" style="width: 60px;" value="0" id="tysj">秒
			</div>
		</div>
		<div data-options="region:'west'" style="width: 200px;">
			<ul class="check-menu">
				
			</ul>
		</div>

		<div data-options="region:'center'" border=0>
			<div class="easyui-layout" fit='true'>
				<div data-options="region:'center'">
					<!--[if IE]>
					   <object type='application/x-vlc-plugin' id='vlc' events='True'
					       classid='clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921' width="720" height="540">
					          <param name='mrl' value='' />
					          <param name='volume' value='50' />
					          <param name='autoplay' value='false' />
					          <param name='loop' value='false' />
					          <param name='fullscreen' value='false' />
					    </object>
					<![endif]-->
					<!--[if !IE]><!-->
					    <object type='application/x-vlc-plugin' id='vlc' events='True' style="width: 800px;height: 540px;">
					        <param name='mrl' value='' />
					        <param name='volume' value='50' />
					        <param name='autoplay' value='true' />
					    </object>
					<!--<![endif]-->
				</div>
			</div>
		</div>
	</div>											    
</div>

<div id="process_tb">
<a href="#" class="easyui-linkbutton" data-options="plain:true,onClick:redowload">重新下载</a>
</div>
<script type="text/javascript">
var vcList;
var jyjgmc;
var jcxdh;
//图片展示
function showImg(value, row, index){
		return "<img style='' border='0' src='/veh/images/play.ico' onclick='openPlayWin(\""+row.jylsh+"\",\""+row.hphm+"\",\""+row.jycs+"\",\""+row.jyxm+"\",\""+row.kssj+"\",\""+row.jssj+"\")'/>";
}

function redowload(){
	var rows = $("#grid_process").datagrid("getSelections");
	if(rows.length==0){
		$.messager.alert("提示","请选择需要重新下载的视频！");
		return;
	}else{
		var ids ="";
		$.each(rows,function(i,n){
			ids+=n.id+","
		});
		
		if(ids!=""){
			ids=ids.substring(0,ids.length-1);
		}
		$.post("/veh/report/reloadVideo",{"ids":ids},function(data){
			$.messager.alert("提示",data.message);
			$("#grid_process").datagrid("reload");
		}).error(function(e){
			$.messager.alert("错误","系统下载重置失败","error");
		});
		
		
		
	}
	
}


$(function(){
	$.post("/veh/video/getAllVideoConfig",function(data){
		vcList = data.vcList;
		jyjgmc = data.jyjgmc;
	}).complete(function(){
		
	});
	var reportData = $("#checkingVeh").datagrid("getSelected");
	jcxdh = reportData.jcxdh;
	$("#grid_process").datagrid({
		url:'/veh/report/getProcess?jylsh='+reportData.jylsh,
		toolbar: '#process_tb',
	    columns:[[
	        {field:'jylsh',title:'检验流水号',width:120},
	        {field:'hphm',title:'号牌号码',width:80},
	        {field:'hpzl',title:'号牌种类',width:80},
	        {field:'clsbdh',title:'车辆识别代号',width:140},
	        {field:'jyxm',title:'检验项目',width:60},
	        {field:'jycs',title:'检验次数',width:60},
	        {field:'kssj',title:'开始时间',width:100},
	        {field:'jssj',title:'结束时间',width:100},
	        {field:'id',title:'视频播放',width:60,formatter:showImg,align:'center'},
	        {field:'jygcxrsj',title:'检验过程写入时间',width:110},
	        {field:'jysbbh',title:'检验设备编码',width:120},
	        {field:'jyzt',title:'检验状态',width:60},
	        {field:'voideSate',title:'视频下载状态',width:80}
	    ]]
	});
})

/////

	var playInfo;
	
	var m_bDVRControl =null;
	var m_iLoginUserId;
	var m_iPlay = 0;                             //是否播放
	var m_iProtocolType = 0;                         //协议类型，0 – TCP， 1 - UDP
	var m_iStreamType = 0;                           //码流类型，0 表示主码流， 1 表示子码流
	var m_iChannelNum;
	var m_iIPChannelNum;
	var m_iIPChannelNum;
	var m_szDeviceType;
	var channelList=[];
	var m_iPlayback=0;

	function openPlayWin(jylsh,hphm,jycs,jyxm,kssj,jssj){
		var reportData = $("#checkingVeh").datagrid("getSelected");
		
		window.open("/veh/video/play2?jylsh="+jylsh+"&jyjgbh="+reportData.jyjgbh);
			
	}
	
	
	function play(jyxm,jycs,channel){
		
		
		
	}
	
	
	

</script>