
<form method="post" id="curbWeightForm" >
<table style="margin: 0 auto;padding-top: 50px;width: 600px;" >
<tr>
	<td colspan="4" style="text-align: center; font-size: 24px;">整备质量<br><br></td>
</tr>

<tr>
	<td>检验流水号：</td><td><span id="commit_jylsh"></span></td>
	<td>号牌号码：</td><td><span id="commit_hphm"></span></td>
</tr>
<tr>
	<td>出厂整备质量：</td><td><span id="commit_zbzl" ></span>KG</td>
	<td>检测整备质量：</td><td><input class="easyui-numberbox" data-options="onChange:zbzlchange" name="zbzl" id="zbzl" required="true" max="99999999" min="1" >KG</td>
</tr>
<tr>
<td>整备质量判定：</td>
<td colspan="3"><label for="zbzlpd_hg">合格</label><input type="radio" name="zbzlpd" id="zbzlpd_hg" value="1" readonly="readonly"  disabled="disabled">
	<label for="zbzlpd_bhg">不合格</label><input type="radio" name="zbzlpd" id="zbzlpd_bhg" value="2"  readonly="readonly" disabled="disabled">
	</td>
</tr>
<tr>
	<td colspan="4" style="text-align: center;height: 80px;">
		<input name="jylsh" type="hidden">
		<input name="jyjgbh" type="hidden">
		<input name="jcxdh" type="hidden">
		<input name="hpzl" type="hidden">
		<input name="hphm" type="hidden">
		<input name="clsbdh" type="hidden">
		<input name="id" type="hidden">
		<!-- <a href="#" class="easyui-linkbutton c6" data-options="onClick:startCurbWeight" id="btn_startCurbWeight">开始检测整备质量</a>
		<a href="#" class="easyui-linkbutton c6" data-options="onClick:curbWeightForm" id="btn_curbWeightForm">保&nbsp;&nbsp;&nbsp;&nbsp;存</a>  -->
		
		<a href="#" class="easyui-linkbutton c6" data-options="onClick:printCurbWeight" id="a_printCurbWeight">打&nbsp;&nbsp;&nbsp;&nbsp;印</a> 
	</td>
</tr>
</table>
</form>

<div id="curbReportTemp2" >
	<div style="width: 725px;margin: 0 auto;" >
		<h1 style="text-align: center;">机动车整备质量检验报告</h1>
	</div>
	<div style="width: 725px;margin: 0 auto;padding-top: 10px;height:30px;" >
		<div style="width: 400px;display:block;float: left;"><label>检验机构名称：</label><span >郴州市宏顺机动车检测有限公司</span></div>
	</div>
	<div style="width: 725px;margin: 0 auto;padding-top: 20px;height: 20px;">
		<div style="width: 400px;display:block;float: left;"><label>检验流水号：</label><span name="report-baseInfo-jylsh"></span></div>
		<div style="width: 200px;display:block;float: left;"><label>检验日期：</label><span name="report-baseInfo-upLineDate"></span></div>
		<div style="width: 100px;display:block;float: left;"><label>检验次数：</label><span name="report-baseInfo-jycs"></span></div>
	</div>
	<TABLE cellSpacing=0 cellPadding=0 border=0   style="width: 725px;margin: 0 auto;border-left: 1px solid;border-top: 1px solid;">
		<TBODY>
			<tr>
				<td colspan="6" style="border-right: 1px solid;border-bottom: 1px solid;height:40px;"><h3>车辆信息</h3></td>
			</tr>
			<tr>
				<td style="width: 80px;text-align: center;border-right: 1px solid;border-bottom: 1px solid;height: 40px;" >号牌号码：</td>
				<td style="width: 140px;border-right: 1px solid;border-bottom: 1px solid;text-align: center;height: 40px;" name="report-baseInfo-hphm"></td>
				<td style="width: 120px;text-align: center;border-right: 1px solid;border-bottom: 1px solid;height: 40px;">车主单位:</td>
				<td colspan="3" style="border-right: 1px solid;border-bottom: 1px solid;text-align: center;height: 40px;" name="report-baseInfo-syr"></td>
			</tr>
			<tr>
				<td style="width: 80px;text-align: center;border-right: 1px solid;border-bottom: 1px solid;height: 40px;">车辆类型：</td>
				<td style="width: 140px;border-right: 1px solid;border-bottom: 1px solid;text-align: center;height: 40px;" name="report-baseInfo-cllx"></td>
				<td style="width: 80px;text-align: center;border-right: 1px solid;border-bottom: 1px solid;height: 40px;">车辆识别代号:</td>
				<td colspan="3" style="border-right: 1px solid;border-bottom: 1px solid;text-align: center;height: 40px;" name="report-baseInfo-clsbdh"></td>
			</tr>
			<tr>
				<td style="width: 80px;text-align: center;border-right: 1px solid;border-bottom: 1px solid;height: 40px;">数据项目</td>
				<td style="width: 140px;text-align: center;border-right: 1px solid;border-bottom: 1px solid;height: 40px;">车辆标准质量(kg)</td>
				<td style="width: 80px;text-align: center;border-right: 1px solid;border-bottom: 1px solid;height: 40px;">测量数据(kg)</td>
				<td style="width: 80px;text-align: center;border-right: 1px solid;border-bottom: 1px solid;height: 40px;">差值(kg)</td>
				<td style="width: 80px;text-align: center;border-right: 1px solid;border-bottom: 1px solid;height:40px;">限制标准</td>
				<td style="width: 80px;text-align: center;border-right: 1px solid;border-bottom: 1px solid;height: 40px;">结果判定</td>
			</tr>
			<tr>
				<td style="width: 80px;border-right: 1px solid;border-bottom: 1px solid;text-align: center;height: 40px;"></td>
				<td style="width: 140px;border-right: 1px solid;border-bottom: 1px solid;text-align: center;height: 40px;" name="report-baseInfo-zbzl"></td>
				<td style="width: 80px;border-right: 1px solid;border-bottom: 1px solid;text-align: center;height: 40px;" id="report-cw-zbzl"></td>
				<td style="border-right: 1px solid;border-bottom: 1px solid;text-align: center;height: 40px;" id="report-cw-zbzlzc"></td>
				<td style="border-right: 1px solid;border-bottom: 1px solid;text-align: center;height: 40px;" >±3%或500KG</td>
				<td style="border-right: 1px solid;border-bottom: 1px solid;text-align: center;height: 40px;" id="report-cw-zbzlpd"></td>
			</tr>
		</TBODY>
	</TABLE>
	<TABLE cellSpacing=0 cellPadding=0 border=0   style="width: 725px;margin: 0 auto;border-left: 1px solid;">
		<tbody>
			<tr>
				<td colspan="2" style="padding-top: 10px;border-right: 1px solid;border-bottom: 1px solid;height:50px;"><h3>检测照片</h3></td>
			</tr>
			<tr>
				<td style="width: 360px;height:180px;border-right: 1px solid;border-bottom: 1px solid;">
					<img alt="" src="" style="width: 360px;height:180px;">
				</td>
				<td style="width: 360px;height:180px;border-right: 1px solid;border-bottom: 1px solid;">
					<img alt="" src="" style="width: 360px;height:180px;">
				</td>
			</tr>
		</tbody>
	</TABLE>
	<TABLE cellSpacing=0 cellPadding=0 border=0   style="width: 725px;margin: 0 auto;border-left: 1px solid;">
		<tbody>
			<tr>
				<td style="border-right: 1px solid;border-bottom: 1px solid;height: 40px;">检验员：</td>
				<td style="border-right: 1px solid;border-bottom: 1px solid;height: 40px;">授权签字人：</td>
				<td style="border-right: 1px solid;border-bottom: 1px solid;height: 40px;">检验结论：</td>
			</tr>
			<tr>
				<td style="border-right: 1px solid;border-bottom: 1px solid;height: 60px;" colspan="3">备注：</td>
			</tr>
		</tbody>
	</TABLE>
</div>

<div id="curbReportTemp" style="display: none;">
	<TABLE cellSpacing=0 cellPadding=0 border=0   style="width: 725px;">
		<TBODY>
				<tr colSpan=5>
					<td >
						<img alt="" src="/veh/images/cma.jpg" style="width: 61px;height: 44px;float: left;">
					</td>
					<td colspan="4" style="text-align: center;">
						<h2>机动车整备质量检验报告</h2>
					</td>
					<td style="text-align: right; font-size: 12px;width: 150px;">
						证书编号：XK苏20150321
					</td>
				</tr>
		</TBODY>
	</TABLE>
	<TABLE cellSpacing=0 cellPadding=0 border=1   style="width: 725px;height: 250px;">
		<TBODY>
			<TR>
				<TD colSpan=6>一、基本信息</TD>
			</TR>
			<TR>
				<TD class=l width="15%">检验流水号</TD>
				<TD class=r width="18%" name="report-baseInfo-jylsh"></TD>
				<TD class=l width="15%">检测机构名称</TD>
				<td colspan="3" id="curbTitle" >
				</td>
			</TR>
			<tr>
				<TD class=l width="15%">引&nbsp;&nbsp;车&nbsp;&nbsp;员</TD>
				<TD class=r width="19%" name="report-baseInfo-ycy"></TD>
				<TD class=l width="15%">检&nbsp;验&nbsp;日&nbsp;期</TD>
				<TD class=r  name="report-baseInfo-upLineDate"></TD>
				<TD class=l  width="15%" >所&nbsp;&nbsp;有&nbsp;&nbsp;人</TD>
				<TD class=r  name="report-baseInfo-syr" ></TD>
			</tr>
			<TR>
				<TD class=l>号牌号码</TD>
				<TD class=r name="report-baseInfo-hphm"></TD>
				<TD class=l>号&nbsp;牌&nbsp;种&nbsp;类</TD>
				<TD class=r name="report-baseInfo-hpzl"></TD>
				<TD class=l>车&nbsp;辆&nbsp;类&nbsp;型</TD>
				<TD class=r name="report-baseInfo-cllx"></TD>
			</TR>
			<TR>
				<TD class=l>车辆识别代号</TD>
				<TD class=r name="report-baseInfo-clsbdh"></TD>
				<TD class=l>发&nbsp;动&nbsp;机&nbsp;号</TD>
				<TD class=r colSpan=3 name="report-baseInfo-fdjh"></TD>
			</TR>
			<TR>
				<TD class=l>初次登记日期</TD>
				<TD class=r name="report-baseInfo-ccdjrq"></TD>
				<TD class=l>出厂年月</TD>
				<TD class=r name="report-baseInfo-ccrq"></TD>
				<TD class=l>燃&nbsp;料&nbsp;种&nbsp;类</TD>
				<TD class=r name="report-baseInfo-rlzl"></TD>
			</TR>
			<TR>
				<TD colSpan=6>二、检验结论</TD>
			</TR>
			<TR>
				<TD class=l>整备质量</TD>
				<TD class=r name="" id="report-cw-zbzl"></TD>
				<TD class=l width="15%">检&nbsp;&nbsp;验&nbsp;&nbsp;员</TD>
				<TD class=r  name="report-baseInfo-ycy" colspan="3"></TD>
			</TR>
			<TR>
				<TD colSpan=6>盐城市经济开发区长江路22号&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				   联系电话：0515-88323355 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				   单位名称（盖章）：</TD>
			</TR>
		</TBODY>
	</TABLE>
	
</div>

<div  id="curbWeightPrintArae" style="display: none;">
	

</div>

<script type="text/javascript">
function printCurbWeight(){
	
	var temp =$("#curbReportTemp2").html();
	
	$("#curbWeightPrintArae").html(temp);
	
	report.createReport($("#curbWeightPrintArae"));
	
	
}

function zbzlchange(value){
	var cz =value-reportData.zbzl;
	var czbfj = (cz/reportData.zbzl)*100;
	var cllx = reportData.cllx;
	var xzgj=100;
	var percent=3;
	if(cllx.indexOf('H1')==0||cllx.indexOf('H2')==0||cllx.indexOf('Z1')==0||cllx.indexOf('Z2')==0||cllx.indexOf('Z5')==0||cllx.indexOf('G')==0||cllx.indexOf('B')==0){
		xzgj=500;
	}else if(cllx.indexOf('H3')==0||cllx.indexOf('H4')==0||cllx.indexOf('Z3')==0||cllx.indexOf('Z4')==0){
		xzgj=100;
	}else if(cllx.indexOf('N')==0){
		xzgj=100;
		percent=5;
	}else if(cllx.indexOf('M')==0){
		xzgj=10;
	}
	
	if((cz>=xzgj||cz<=-xzgj)&&(czbfj>=percent||czbfj<=-percent)){
		$("#curbWeightForm #zbzlpd_bhg").prop("checked",true);
	}else{
		$("#curbWeightForm #zbzlpd_hg").prop("checked",true);
	}
}

var reportData = $("#checkingVeh").datagrid("getSelected");
$("#commit_jylsh").text(reportData.jylsh);
$("#commit_hphm").text(reportData.hphm);
$("#commit_zbzl").text(reportData.zbzl);

	$(function(){
		
		var baseInfo = $("#tab-report").tabs("getSelected").panel("options").baseInfo;
		
		$("#curbTitle").text(vehComm.jyjgmc);
		$.post("/veh/pda/getCurbWeight",{jylsh:reportData.jylsh},function(data){
			 $("#curbWeightForm").form("load",data);
			 $("#report-cw-zbzl").text(data.zbzl);
			 $("#report-cw-zbzlzc").text(Math.abs(data.zbzl-baseInfo.zbzl));
			 $("#report-cw-zbzlpd").text(data.zbzlpd==null?"":veh.jgpd(data.zbzlpd));
		},"json");
		
		$.post("/veh/report/getProcess?jylsh="+reportData.jylsh,function(data){
			$("#btn_curbWeightForm").linkbutton('disable');
			$("#btn_startCurbWeight").linkbutton('disable');
			$.each(data,function(i,n){
				if(n.jyxm=="Z1"&&n.kssj!=""&&n.kssj!=null){
					$("#btn_curbWeightForm").linkbutton('enable');
				}
				if(n.jyxm=="Z1"&&(n.kssj==""||n.kssj==null)){
					$("#btn_startCurbWeight").linkbutton('enable');
				}
				
				if(n.jyxm=="Z1"&&n.jssj!=null&&n.jssj!=""){
					$("#btn_curbWeightForm").linkbutton('disable');
					$("#btn_startCurbWeight").linkbutton('disable');
				}
				
			});
		},"json");
		
	
		
		$("#curbReportTemp2 [name^='report-baseInfo-']").each(function(i,n){
			var name = $(n).attr("name").replace("report-baseInfo-","");
			
			$(n).text(baseInfo[name]==null?"":comm.getParamNameByValue(name, baseInfo[name]));
		});
		
		
		
	});

	function curbWeightForm(){
		
		 if($("#curbWeightForm [name=id]").val()!=""){
			$.messager.alert("提示","整备质量已经检测结束！","info");
			return;
		}
		if(reportData.vehjczt==2){
			$.messager.alert("提示","车辆检测结束，不允许提交整备质量！","info");
			return;
		}
		if(reportData.jyxm.indexOf("Z1")==-1){
			$.messager.alert("提示","该检测项目无整备质量","info");
			return;
		}
		
		var flag = $("#curbWeightForm").form("validate");
		 if(!flag){
			return;
		}
		 var zbzlpd = $("#curbWeightForm [name=zbzlpd]:checked").val();
		 
		 if(zbzlpd==2||zbzlpd==""){
			 $.messager.alert("提示","检验结果不合格！不允许上传。","info");
				return;
		 }
		 
		$("#curbWeightForm [name=jylsh]").val(reportData.jylsh);
        $("#curbWeightForm [name=jyjgbh]").val(reportData.jyjgbh);
        $("#curbWeightForm [name=jcxdh]").val(reportData.jcxdh);
        $("#curbWeightForm [name=hpzl]").val(reportData.hpzl);
        $("#curbWeightForm [name=hphm]").val(reportData.hphm);
        $("#curbWeightForm [name=clsbdh]").val(reportData.clsbdh);
        var data={};

        data.jylsh=$("#curbWeightForm [name=jylsh]").val();
        data.jyjgbh=$("#curbWeightForm [name=jyjgbh]").val();
        data.jcxdh=$("#curbWeightForm [name=jcxdh]").val();
        data.hpzl=$("#curbWeightForm [name=hpzl]").val();
        data.hphm=$("#curbWeightForm [name=hphm]").val();
        data.clsbdh=$("#curbWeightForm [name=clsbdh]").val();
        data.id=$("#curbWeightForm [name=id]").val();
        data.zbzl=$("#curbWeightForm [name=zbzl]").val();
        data.zbzlpd=$("#curbWeightForm [name=zbzlpd]").val();
        data.jycs=reportData.jycs;
        
		console.log(data)
        $.post("/veh/pda/zbzlUpload",data,function(data){
        	 if(data.state==1){
	        	 $.messager.alert("提示",data.message);
	        	 $("#commitForm [name=id]").val(data.id);
		    }
         },"json");
		//$("#commitForm").form("submit");
	}
	
	function startCurbWeight(){
		
		 $.post("/veh/pda/processStart",{jyxm:'Z1',jylsh:reportData.jylsh,jycs:reportData.jycs},function(data){
        	 if(data.state==1){
	        	$.messager.alert("提示",data.message);
	        	$("#btn_curbWeightForm").linkbutton('enable');
	        	$("#btn_startCurbWeight").linkbutton('disable');
		    }
         },"json");
		$.messager.alert("提示","车辆未开始检测，或已经检测结束！","info");
		
	}
	
</script>